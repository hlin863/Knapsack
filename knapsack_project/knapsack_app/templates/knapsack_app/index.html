{% load static %} <!-- Add this line to load the static template tags -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingredient Library</title>
    <!-- Load the static files -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>
    <h1>Ingredient Library</h1>

    <!-- Create the image panel -->
    <div class="image-panel">
        <!-- Image container for Flour -->
        <div class="image-container">
            <p>Flour</p>
            <img src="{% static 'img/flour.jpg' %}" alt="Flour">
            <table class="image-details">
                <tr>
                    <th>Value</th>
                    <th>Quantity</th>
                    <th>Weight</th>
                </tr>
                <tr>
                    <td id="flour-value">$2.99</td>
                    <td id="flour-quantity">500g</td>
                    <td id="flour-weight">0.5 kg</td>
                </tr>
            </table>
        </div>
    
        <!-- Image container for Butter -->
        <div class="image-container">
            <p>Butter</p>
            <img src="{% static 'img/butter.jpg' %}" alt="Butter">
            <table class="image-details">
                <tr>
                    <th>Value</th>
                    <th>Quantity</th>
                    <th>Weight</th>
                </tr>
                <tr>
                    <td id="butter-value">$3.49</td>
                    <td id="butter-quantity">200g</td>
                    <td id="butter-weight">0.2 kg</td>
                </tr>
            </table>
        </div>
    
        <!-- Image container for Sugar -->
        <div class="image-container">
            <p>Sugar</p>
            <img src="{% static 'img/sugar.jpg' %}" alt="Sugar">
            <table class="image-details">
                <tr>
                    <th>Value</th>
                    <th>Quantity</th>
                    <th>Weight</th>
                </tr>
                <tr>
                    <td id="sugar-value">$1.99</td>
                    <td id="sugar-quantity">1 kg</td>
                    <td id="sugar-weight">1 kg</td>
                </tr>
            </table>
        </div>
    </div>


    <!-- Customizer panel -->
    <div class="customizer-panel">
        <!-- Customizer container with 2 rows-->
        <div class="customizer-container">
            <form id="updateForm" method="post" action="{% url 'update_inventory' %}">
                {% csrf_token %}
                <!-- Product Name -->
                <div class="customizer-item">
                    <label for="product">Product Name:</label>
                    <input type="text" id="product" name="product" placeholder="Enter product name...">
                </div>
                <!-- Value -->
                <div class="customizer-item">
                    <label for="value">Value:</label>
                    <input type="text" id="value" name="value" placeholder="Enter value...">
                </div>
                <!-- Quantity -->
                <div class="customizer-item">
                    <label for="quantity">Quantity:</label>
                    <input type="text" id="quantity" name="quantity" placeholder="Enter quantity...">
                </div>
                <!-- Weight -->
                <div class="customizer-item">
                    <label for="weight">Weight:</label>
                    <input type="text" id="weight" name="weight" placeholder="Enter weight...">
                </div>
                <button type="submit" id="updateButton">Update Details</button>
            </form>

        </div>
    </div>

    <script>
        // Function to update image details
        function updateImageDetails() {
            const productNameInput = document.getElementById('product');
            const valueInput = document.getElementById('value');
            const quantityInput = document.getElementById('quantity');
            const weightInput = document.getElementById('weight');
            const imageDetails = document.querySelectorAll('.image-details');

            const productName = productNameInput.value || 'N/A';
            const value = valueInput.value || 'N/A';
            const quantity = quantityInput.value || 'N/A';
            const weight = weightInput.value || 'N/A';

            imageDetails.forEach((detail) => {
                const heading = detail.querySelector('th');
                const data = detail.querySelector('td');

                heading.textContent = `Product: ${productName}`;
                data.textContent = `Value: ${value} | Quantity: ${quantity} | Weight: ${weight}`;
            });
        }

        // Function to reset input fields
        function resetInputs() {
            const inputs = document.querySelectorAll('input[type="text"]');
            inputs.forEach((input) => {
                input.value = '';
            });

            // Update the image details after resetting
            updateImageDetails();
        }

        // Prevent form submission
        const updateForm = document.getElementById('updateForm');
        updateForm.addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission
            updateImageDetails();

            // Submit the form using AJAX to the Django view
            fetch(updateForm.action, {
                method: 'POST',
                body: new FormData(updateForm),
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'), // Include CSRF token
                },
            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response as needed (e.g., show a success message)
                    console.log(data.message);
                })
                .catch(error => {
                    // Handle errors
                    console.error('Error:', error);
                });
        });

        // Function to get CSRF token from cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Listen for button clicks
        const resetButton = document.getElementById('resetButton');
        resetButton.addEventListener('click', resetInputs);

        // Initialize image details
        updateImageDetails();
    </script>




</body>

</html>